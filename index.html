<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>11.0</title>
    <style>
        :root { --primary: #2271b1; --success: #28a745; --error: #dc3545; --bg: #f0f0f1; }
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; background-color: var(--bg); color: #3c434a; margin: 0; padding-bottom: 100px; }
        
        .header { position: fixed; top: 0; left: 0; right: 0; background: #fff; border-bottom: 1px solid #c3c4c7; padding: 15px 20px; z-index: 1000; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 1px 3px rgba(0,0,0,0.05); }
        .logo { font-weight: 800; color: var(--primary); font-size: 1.2rem; }
        .timer-box { font-variant-numeric: tabular-nums; font-size: 1.4rem; font-weight: 700; color: #1d2327; background: #f0f0f1; padding: 5px 15px; border-radius: 4px; }
        
        .container { max-width: 800px; margin: 90px auto 20px; padding: 0 20px; }

        .card { background: #fff; border: 1px solid #c3c4c7; padding: 25px; margin-bottom: 25px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.02); }
        .q-text { font-size: 1.1rem; font-weight: 600; margin-bottom: 20px; color: #1d2327; line-height: 1.5; }
        
        .option-label { display: flex; align-items: flex-start; gap: 12px; padding: 12px; border: 2px solid #f0f0f1; border-radius: 6px; cursor: pointer; transition: all 0.2s; margin-bottom: 10px; font-size: 0.95rem; }
        .option-label:hover { background: #f6f7f7; border-color: var(--primary); }
        .option-label input { margin-top: 3px; transform: scale(1.3); cursor: pointer; flex-shrink: 0; accent-color: var(--primary); }
        
        .fab-finish { position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%); background: #d63638; color: white; padding: 15px 40px; border-radius: 50px; border: none; font-size: 1.2rem; font-weight: bold; cursor: pointer; box-shadow: 0 4px 15px rgba(214, 54, 56, 0.4); z-index: 999; transition: transform 0.2s; white-space: nowrap; }
        .fab-finish:hover { transform: translateX(-50%) scale(1.05); background: #b32d2e; }

        /* MODAL RESULTADOS */
        .modal { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.9); z-index: 2000; justify-content: center; align-items: center; }
        .modal-content { background: white; width: 90%; max-width: 800px; max-height: 90vh; border-radius: 12px; display: flex; flex-direction: column; overflow: hidden; position: relative; }
        
        .modal-header { padding: 20px; background: #f9f9f9; border-bottom: 1px solid #eee; text-align: center; }
        .score-big { font-size: 2.5rem; font-weight: 800; margin: 10px 0; color: var(--primary); }
        .verdict { font-size: 1.5rem; font-weight: 700; text-transform: uppercase; margin-bottom: 10px; }
        
        .modal-body { padding: 20px; overflow-y: auto; flex-grow: 1; text-align: left; background: #f0f0f1; }
        
        .btn-restart { background: var(--primary); color: white; border: none; padding: 15px; font-size: 1.1rem; cursor: pointer; width: 100%; font-weight: bold; }
        .btn-restart:hover { background: #135e96; }

        /* REVISI√ìN DETALLADA */
        .review-item { background: white; padding: 15px; margin-bottom: 15px; border-radius: 8px; border-left: 5px solid #ccc; font-size: 0.95rem; }
        .review-item.r-correct { border-left-color: var(--success); background: #f4fff7; }
        .review-item.r-wrong { border-left-color: var(--error); background: #fff5f5; }
        
        .r-question { font-weight: bold; margin-bottom: 10px; display: block; color: #333; }
        .r-user-ans { display: block; margin-bottom: 5px; }
        .r-correct-ans { display: block; margin-bottom: 5px; color: var(--success); font-weight: 600; }
        .r-explanation { display: block; margin-top: 10px; font-style: italic; color: #666; font-size: 0.9rem; border-top: 1px solid rgba(0,0,0,0.05); padding-top: 5px; }

        .tag-correct { color: var(--success); font-weight: bold; }
        .tag-wrong { color: var(--error); font-weight: bold; text-decoration: line-through; }

        .progress-container { position: fixed; top: 69px; left: 0; width: 100%; height: 4px; background: #e0e0e0; z-index: 998; }
        .progress-bar { height: 100%; background: var(--primary); width: 0%; transition: width 0.3s; }

        .explanation-box { display: none; margin-top: 15px; padding: 12px; background: #f9f9f9; border-left: 4px solid #ccc; border-radius: 4px; font-size: 0.9rem; color: #555; }
        .correct-card .explanation-box { border-left-color: var(--success); background: #f4fff7; }
        .wrong-card .explanation-box { border-left-color: var(--error); background: #fff5f5; }
        .correct-answer { background: #d4edda !important; border-color: var(--success) !important; }
        .user-wrong { background: #f8d7da !important; border-color: var(--error) !important; }
        .options-group { display: flex; flex-direction: column; }
    </style>
</head>
<body>

    <div id="result-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 style="margin:0;">RESULTADO</h2>
                <div id="score-display" class="score-big">0 / 50</div>
                <div id="verdict-text" class="verdict">...</div>
                <div style="font-size:0.9rem; color:#666;">
                    ‚úÖ <span id="res-correct">0</span> | 
                    ‚ùå <span id="res-wrong">0</span>
                </div>
            </div>
            <div class="modal-body" id="detailed-review"></div>
            <button class="btn-restart" onclick="location.reload()">REPETIR EXAMEN</button>
        </div>
    </div>

    <header class="header">
        <div class="logo">EXAMEN WP AVANZADO</div>
        <div class="timer-box" id="timer">45:00</div>
    </header>
    <div class="progress-container"><div class="progress-bar" id="progress"></div></div>

    <div class="container" id="quiz-container"></div>

    <button class="fab-finish" onclick="finishExam()">FINALIZAR Y CALIFICAR</button>

<script>
const DB = [
        // --- BLOQUE 1: CORE DE WORDPRESS Y ARCHIVOS ---
        { q: "¬øEn qu√© archivo exacto se definen las credenciales de la base de datos (DB_NAME, DB_USER)?", o: ["En el archivo wp-admin.php", "En el archivo wp-config.php", "En el archivo wp-settings.php", "En el archivo database.php"], a: 1, e: "wp-config.php es el √∫nico archivo que conecta la instalaci√≥n PHP con la base de datos." },
        { q: "Si los enlaces permanentes dan error 404, ¬øqu√© acci√≥n regenera el archivo .htaccess?", o: ["Guardar cambios en Enlaces Permanentes", "Reinstalar el n√∫cleo de WordPress", "Desactivar y activar los plugins", "Cambiar el tema activo actual"], a: 0, e: "Al pulsar 'Guardar cambios' en Ajustes > Enlaces permanentes, WP reescribe las reglas de ruta." },
        { q: "¬øQu√© l√≠nea es obligatoria en la cabecera del style.css para que funcione un Tema Hijo?", o: ["@import: url(style.css)", "Template: carpeta-tema-padre", "Parent: nombre-tema-padre", "Require: functions.php"], a: 1, e: "La etiqueta 'Template' indica a WordPress de qu√© directorio debe heredar la funcionalidad." },
        { q: "¬øQu√© sucede en el frontend si desactivas un plugin que generaba un Shortcode activo?", o: ["Se muestra un error 500 fatal", "Desaparece todo el contenido", "Se muestra el c√≥digo [shortcode]", "Se muestra un espacio en blanco"], a: 2, e: "WordPress deja de procesar la etiqueta y la muestra como texto plano entre corchetes." },
        { q: "¬øQu√© constante debes activar en wp-config.php para ver errores PHP en pantalla?", o: ["define('WP_DEBUG', true);", "define('SHOW_ERRORS', true);", "define('WP_ERROR_LOG', true);", "define('DISPLAY_ERRORS', true);"], a: 0, e: "WP_DEBUG es la constante est√°ndar de WordPress para el modo de depuraci√≥n." },
        { q: "En la jerarqu√≠a de plantillas, ¬øqu√© archivo tiene prioridad para una entrada individual?", o: ["index.php", "page.php", "single.php", "archive.php"], a: 2, e: "WordPress busca 'single.php' para posts. Si no existe, usa 'singular.php' o 'index.php'." },
        { q: "¬øEn qu√© tabla de la base de datos se guardan las URLs 'siteurl' y 'home'?", o: ["En la tabla wp_config", "En la tabla wp_options", "En la tabla wp_links", "En la tabla wp_meta"], a: 1, e: "wp_options almacena la configuraci√≥n global cr√≠tica del sitio." },
        { q: "¬øQu√© diferencia funcional hay entre Categor√≠as y Etiquetas en WordPress?", o: ["Las Categor√≠as son jer√°rquicas; las Etiquetas son planas", "Las Etiquetas son jer√°rquicas; las Categor√≠as son planas", "Las Categor√≠as son obligatorias; las Etiquetas opcionales", "No hay diferencia funcional, solo es una distinci√≥n visual"], a: 0, e: "La jerarqu√≠a permite que las categor√≠as tengan 'padres' e 'hijos'; las etiquetas no." },
        { q: "¬øQu√© capacidad distingue al rol Administrador del rol Editor?", o: ["Publicar entradas de otros", "Moderar los comentarios", "Instalar plugins y temas", "Subir archivos multimedia"], a: 2, e: "El Editor gestiona contenido; solo el Admin gestiona la configuraci√≥n del sistema." },
        { q: "Si quieres una p√°gina de inicio est√°tica, ¬ød√≥nde realizas el cambio?", o: ["Ajustes > Generales > Portada", "Apariencia > Temas > Inicio", "Ajustes > Lectura > Portada", "Entradas > Fijar en portada"], a: 2, e: "En Ajustes de Lectura defines qu√© p√°gina act√∫a como 'Home' y cu√°l como 'Blog'." },

        // --- BLOQUE 2: ELEMENTOR Y DISE√ëO ---
        { q: "¬øQu√© propiedad CSS corrige el solapamiento de dos secciones 'Sticky'?", o: ["Margin-top", "Z-Index", "Opacity", "Padding"], a: 1, e: "El Z-Index controla el eje de profundidad; el valor m√°s alto queda encima." },
        { q: "¬øQu√© hace la herramienta 'Regenerar CSS' en Elementor > Herramientas?", o: ["Borra los estilos personalizados", "Restablece los ajustes globales", "Limpia cach√© y crea nuevos CSS", "Actualiza la versi√≥n del editor"], a: 2, e: "Fuerza la creaci√≥n de nuevos archivos CSS externos cuando los cambios no se ven." },
        { q: "¬øQu√© unidad usar√≠as para que una secci√≥n ocupe el 100% de la altura de pantalla?", o: ["100 %", "100 PX", "100 EM", "100 VH"], a: 3, e: "VH (Viewport Height) se adapta din√°micamente al tama√±o de la ventana del navegador." },
        { q: "¬øPara qu√© sirve el 'Navegador' (Navigator) en la interfaz de Elementor?", o: ["Para ver la vista previa web", "Para acceder a capas ocultas", "Para buscar widgets nuevos", "Para ver el historial cambios"], a: 1, e: "Permite seleccionar elementos superpuestos o con visibilidad oculta." },
        { q: "¬øC√≥mo evitas que el men√∫ fijo tape un t√≠tulo al hacer clic en un ancla?", o: ["Usando Margen Superior", "Usando Desplazamiento (Offset)", "Usando Relleno Inferior", "Usando Posici√≥n Absoluta"], a: 1, e: "El Offset de ancla compensa la altura de la cabecera sticky." },
        { q: "¬øQu√© ventaja principal tienen los 'Colores Globales' en Elementor?", o: ["Permiten m√°s variedad de color", "Mejoran la carga de la p√°gina", "Actualizan todo el sitio a la vez", "Permiten degradados complejos"], a: 2, e: "Facilitan el mantenimiento: cambias el color en un sitio y se aplica en todos." },
        { q: "Para editar un bloque en varias p√°ginas a la vez, ¬øqu√© elemento usas?", o: ["Una Plantilla de P√°gina", "Un Widget Global", "Un Bloque HTML", "Un Shortcode"], a: 1, e: "El Widget Global sincroniza contenido y estilo en todas sus instancias." },
        { q: "¬øQu√© pierdes si desactivas Elementor Pro manteniendo la versi√≥n Free?", o: ["Todo el contenido maquetado", "Widgets Pro y Theme Builder", "El acceso al panel de control", "Las im√°genes de la galer√≠a"], a: 1, e: "El contenido b√°sico se queda, pero las funciones avanzadas (formularios, headers) desaparecen." },
        { q: "En Theme Builder, ¬øqu√© condici√≥n aplica una plantilla solo a una categor√≠a?", o: ["Singular > Entradas", "Archivo > Categor√≠as", "Include > En Categor√≠a", "Todo el sitio"], a: 2, e: "Debes filtrar espec√≠ficamente por la taxonom√≠a deseada en las condiciones." },
        { q: "¬øPara qu√© sirven los 'Puntos de Ruptura' (Breakpoints) personalizados?", o: ["Para reiniciar el dise√±o web", "Para definir el ancho de cambio", "Para ocultar secciones m√≥vil", "Para separar columnas flex"], a: 1, e: "Determinan a cu√°ntos p√≠xeles cambia el dise√±o de Escritorio a Tablet o M√≥vil." },

        // --- BLOQUE 3: WOOCOMMERCE ---
        { q: "Para un servicio sin env√≠o f√≠sico, ¬øqu√© marcas en el producto?", o: ["Virtual", "Descargable", "Gesti√≥n stock", "Env√≠o local"], a: 0, e: "'Virtual' desactiva el c√°lculo de env√≠o en el checkout." },
        { q: "¬øQu√© es obligatorio antes de crear variaciones de producto?", o: ["Subir la imagen destacada", "Definir Atributos usados", "Establecer precio base", "Activar gesti√≥n stock"], a: 1, e: "Sin atributos asignados 'para variaciones', WooCommerce no puede generar opciones." },
        { q: "¬øD√≥nde personalizas los colores de los correos de pedidos?", o: ["En el Personalizador", "En Ajustes > Correos", "En functions.php", "En el servidor"], a: 1, e: "WooCommerce > Ajustes > Correos electr√≥nicos permite cambios b√°sicos de dise√±o." },
        { q: "¬øQu√© producto permite vender un pack de √≠tems por separado?", o: ["Producto Variable", "Producto Agrupado", "Producto Externo", "Producto Simple"], a: 1, e: "Agrupa varios productos simples en una sola ficha padre." },
        { q: "Si los correos no llegan, ¬øqu√© soluci√≥n t√©cnica se recomienda?", o: ["Reinstalar WooCommerce", "Instalar plugin SMTP", "Revisar carpeta spam", "Cambiar el dise√±o"], a: 1, e: "SMTP autentica el env√≠o, solucionando el bloqueo de PHP Mail." },
        { q: "¬øC√≥mo configuras env√≠os distintos para Canarias y Pen√≠nsula?", o: ["Con plugins de pago", "Con Zonas de Env√≠o", "Con Cupones", "Con Clases de Env√≠o"], a: 1, e: "Las Zonas de Env√≠o discriminan por c√≥digo postal o regi√≥n geogr√°fica." },
        { q: "¬øQu√© estado indica pago recibido y listo para env√≠o?", o: ["Pendiente de pago", "En espera", "Procesando", "Completado"], a: 2, e: "'Procesando' es el estado correcto tras el cobro. 'Completado' es tras el env√≠o." },
        { q: "Para usar WooCommerce como cat√°logo, ¬øqu√© debes ocultar?", o: ["La pasarela de pago", "El bot√≥n de compra", "El stock del producto", "La p√°gina de tienda"], a: 1, e: "Sin bot√≥n de a√±adir al carrito, la tienda funciona como cat√°logo visual." },
        { q: "¬øQu√© hace la opci√≥n 'Gesti√≥n de inventario' en el producto?", o: ["Muestra disponibilidad", "Descuenta stock real", "Cambia el precio", "Reserva en carrito"], a: 1, e: "Resta unidades autom√°ticamente al confirmarse un pedido." },
        { q: "¬øWooCommerce genera facturas PDF legales por defecto?", o: ["S√≠, en el correo", "No, requiere plugin", "S√≠, en Ajustes", "Solo versi√≥n Pro"], a: 1, e: "Nativamente solo env√≠a recibos simples en el cuerpo del email." },

        // --- BLOQUE 4: OPTIMIZACI√ìN Y SEGURIDAD ---
        { q: "¬øQu√© hace el 'Lazy Load' con las im√°genes?", o: ["Las comprime al subir", "Difiere su carga", "Reduce su calidad", "Elimina los metadatos"], a: 1, e: "Solo carga la imagen cuando el usuario hace scroll hasta ella." },
        { q: "El 'Error HTTP' al subir im√°genes suele deberse a:", o: ["Formato incorrecto", "Falta de recursos", "Nombre muy largo", "Biblioteca llena"], a: 1, e: "Exceso de dimensiones o falta de memoria PHP para procesar el archivo." },
        { q: "¬øQu√© hace un plugin de cach√© de p√°gina?", o: ["Limpia la base de datos", "Sirve HTML est√°tico", "Optimiza im√°genes", "Bloquear ataques"], a: 1, e: "Evita procesar PHP/MySQL en cada visita, sirviendo una copia r√°pida." },
        { q: "¬øPor qu√© cambiar el prefijo 'wp_' de la base de datos?", o: ["Mejora la velocidad", "Seguridad por oscuridad", "Permite m√°s plugins", "Requisito de instalaci√≥n"], a: 1, e: "Dificulta que los bots adivinen los nombres de las tablas para inyecciones SQL." },
        { q: "Ante una 'Pantalla Blanca' por plugin, ¬øc√≥mo accedes?", o: ["Borrando base de datos", "Renombrando carpeta", "Esperando reinicio", "Reinstalando WP"], a: 1, e: "Al cambiar el nombre por FTP, WP desactiva el plugin forzosamente." },
        { q: "¬øQu√© controla el archivo robots.txt?", o: ["Seguridad del admin", "Rastreo de bots", "Redirecciones 301", "Conexi√≥n a la DB"], a: 1, e: "Indica a Google qu√© partes de la web puede indexar (Allow/Disallow)." },
        { q: "¬øQu√© es el 'Contenido Mixto' en una web SSL?", o: ["Varios idiomas", "Recursos HTTP en HTTPS", "Enlaces rotos", "Tipos de post"], a: 1, e: "Rompe el candado verde al cargar scripts o im√°genes no seguras." },
        { q: "¬øQu√© plugin es est√°ndar para migraciones completas?", o: ["Yoast SEO", "All-in-One Migration", "Jetpack", "W3 Total Cache"], a: 1, e: "Empaqueta archivos y base de datos en un solo archivo." },
        { q: "Seg√∫n RGPD, el checkbox de privacidad debe estar:", o: ["Marcado por defecto", "Desmarcado obligatorio", "Visible opcional", "Oculto al usuario"], a: 1, e: "Requiere una acci√≥n afirmativa del usuario." },
        { q: "¬øHerramienta externa recomendada para optimizar im√°genes?", o: ["Photoshop", "Squoosh.app", "Editor WP", "Paint"], a: 1, e: "Optimizar antes de subir es mejor que cargar el servidor con plugins." },

        // --- BLOQUE 5: GENERAL T√âCNICO ---
        { q: "¬øCu√°ndo es necesario usar un 'Custom Post Type'?", o: ["Para cambiar dise√±o", "Para contenido espec√≠fico", "Para usar WooCommerce", "Para p√°ginas contacto"], a: 1, e: "Para datos que no encajan en la estructura de Entrada o P√°gina (ej: Inmuebles)." },
        { q: "¬øMejor forma de a√±adir scripts (Analytics) al head?", o: ["En cada entrada", "Con plugin de Snippets", "Editando index.php", "En CSS adicional"], a: 1, e: "Evita perder el c√≥digo al actualizar el tema." },
        { q: "¬øQu√© implica el dise√±o 'Mobile First'?", o: ["Solo dise√±o m√≥vil", "Priorizar m√≥vil y escalar", "Google ignora PC", "Usar Apps nativas"], a: 1, e: "Dise√±ar la estructura base para pantallas peque√±as primero." },
        { q: "¬øPara qu√© sirve el atributo 'alt' en im√°genes?", o: ["Mostrar t√≠tulo", "Accesibilidad y SEO", "Poner borde", "Reducir peso"], a: 1, e: "Describe la imagen a Google y lectores de pantalla." },
        { q: "¬øPlugin est√°ndar para webs multiidioma?", o: ["WooCommerce", "WPML o Polylang", "Yoast SEO", "Elementor"], a: 1, e: "Gestionan la traducci√≥n y relaci√≥n de contenidos." },
        { q: "¬øQu√© es un 'Breadcrumb' (Miga de pan)?", o: ["Men√∫ footer", "Rastro de navegaci√≥n", "Error de carga", "Cookie de sesi√≥n"], a: 1, e: "Mejora la UX y la estructura de enlaces internos." },
        { q: "Diferencia entre Hosting y Dominio:", o: ["Son lo mismo", "Alojamiento vs Direcci√≥n", "Nombre vs Servidor", "Gratis vs Pago"], a: 1, e: "Hosting guarda archivos; Dominio es la direcci√≥n web." },
        { q: "Si falla el correo de recuperaci√≥n, ¬øc√≥mo cambias la clave?", o: ["No se puede", "Editando la Base de Datos", "Creando web nueva", "Llamando al hosting"], a: 1, e: "Modificando el hash MD5 en la tabla wp_users." },
        { q: "¬øQu√© es un 'Shortcode' en WordPress?", o: ["Error c√≥digo", "Etiqueta din√°mica [ ]", "Contrase√±a", "Enlace permanente"], a: 1, e: "Ejecuta funciones complejas con una etiqueta simple." },
        { q: "¬øMejor pr√°ctica antes de actualizar WordPress?", o: ["Actualizar directo", "Hacer copia seguridad", "No actualizar", "Solo plugins"], a: 1, e: "El backup es el √∫nico seguro ante fallos." },

        // --- BLOQUE 6: CONCEPTOS INTERFAZ ---
        { q: "¬øQu√© es el 'Modo Mantenimiento'?", o: ["Error 404", "P√°gina de espera temporal", "Fallo servidor", "Plugin cach√©"], a: 1, e: "Oculta la web mientras se realizan cambios." },
        { q: "Si la web carga sin estilos (CSS), ¬øqu√© falla?", o: ["Base de datos", "Rutas HTTP/HTTPS", "Falta memoria", "Tema borrado"], a: 1, e: "Suele ser bloqueo de contenido mixto o error en URLs." },
        { q: "¬øQu√© es un 'Iframe' en HTML?", o: ["Imagen", "Ventana de contenido externo", "Plugin", "Error"], a: 1, e: "Embebe v√≠deos o mapas de otros sitios." },
        { q: "¬øQu√© es 'Gutenberg' en WordPress?", o: ["Un tema", "El editor de bloques", "Plugin seguridad", "Hosting"], a: 1, e: "El editor de contenido nativo actual." },
        { q: "¬øPara qu√© sirve un 'Sidebar'?", o: ["Men√∫ principal", "Zona lateral de widgets", "Pie p√°gina", "Imagen"], a: 1, e: "Barra lateral cl√°sica para widgets." },
        { q: "Diferencia 'Redirecci√≥n 301' vs '302':", o: ["Ninguna", "Permanente vs Temporal", "Error vs Acierto", "Lenta vs R√°pida"], a: 1, e: "301 traspasa la autoridad SEO." },
        { q: "¬øQu√© es el archivo 'functions.php'?", o: ["Configuraci√≥n", "Plugin del tema", "Base datos", "Estilo"], a: 1, e: "Extiende la funcionalidad del tema activo." },
        { q: "¬øQu√© es 'MySQL' en este contexto?", o: ["Dise√±o", "Gestor de Base de Datos", "Servidor", "Plugin"], a: 1, e: "Donde se guarda toda la informaci√≥n." },
        { q: "Si el cron de WP falla, ¬øqu√© se recomienda?", o: ["Desactivar y usar cron real", "Borrarlo", "Plugin cron", "Nada"], a: 0, e: "El cron del servidor es m√°s fiable." },
        { q: "¬øQu√© es una 'Landing Page'?", o: ["Blog", "P√°gina de conversi√≥n", "Home", "Error"], a: 1, e: "P√°gina enfocada a una sola acci√≥n (CTA)." }
    ];

    let questions = []; 
    let timer;
    let timeLeft = 45 * 60; 

    function init() {
        if(typeof DB === 'undefined') return alert("‚ö†Ô∏è ERROR: No has pegado las preguntas.");
        
        // Seleccionar 50 aleatorias
        questions = DB.sort(() => 0.5 - Math.random()).slice(0, 50);
        
        const container = document.getElementById('quiz-container');
        container.innerHTML = ""; 
        
        questions.forEach((q, index) => {
            // --- FIX: A√±adir comprobaci√≥n para evitar errores si una pregunta no tiene opciones ---
            if (!q.o || !Array.isArray(q.o)) {
                console.error(`Pregunta #${index} omitida por no tener opciones v√°lidas.`, q);
                return; // Saltar esta pregunta
            }
            // --- FIN DEL FIX ---

            let html = `
                <div class="card" id="card-${index}">
                    <div class="q-text"><span style="color:#2271b1; font-weight:800;">#${index + 1}</span> ${q.q}</div>
            `;
            
            // Barajar opciones visualmente
            let indices = q.o.map((_, i) => i);
            indices.sort(() => 0.5 - Math.random());

            html += `<div class="options-group">`;
            indices.forEach(i => {
                html += `
                    <label class="option-label" id="lbl-${index}-${i}">
                        <input type="radio" name="q_${index}" value="${i}">
                        ${q.o[i]}
                    </label>
                `;
            });

            html += `</div>
                     <div class="explanation-box" id="exp-${index}"></div>
                     </div>`;
            container.innerHTML += html;
        });

        startTimer();
        
        // Barra de progreso
        document.querySelectorAll('input').forEach(i => {
            i.addEventListener('change', () => {
                const answered = document.querySelectorAll('input:checked').length;
                document.getElementById('progress').style.width = `${(answered/50)*100}%`;
            });
        });
    }

    window.finishExam = function() {
        clearInterval(timer);
        
        let correctCount = 0;
        let reviewHTML = "";

        // Recorremos las 50 preguntas
        questions.forEach((q, index) => {
            const card = document.getElementById(`card-${index}`);
            const expBox = document.getElementById(`exp-${index}`);
            const selected = document.querySelector(`input[name="q_${index}"]:checked`);
            
            let userVal = selected ? parseInt(selected.value) : -1; 
            let isCorrect = (userVal === q.a);
            
            // Bloquear inputs
            card.querySelectorAll('input').forEach(i => i.disabled = true);

            // LOGICA VISUAL DETALLADA
            if (isCorrect) {
                correctCount++;
                card.classList.add('correct-card');
                document.getElementById(`lbl-${index}-${userVal}`).classList.add('correct-answer');
                expBox.innerHTML = `<strong>‚úÖ ¬°CORRECTO!</strong>${q.e}`;
                
                // Add to modal review
                reviewHTML += `<div class="review-item r-correct"><b>${index+1}. Acierto</b><br>Tu respuesta: ${q.o[userVal]}</div>`;
            
            } else if (userVal !== -1) {
                // Fall√≥
                card.classList.add('wrong-card');
                document.getElementById(`lbl-${index}-${userVal}`).classList.add('user-wrong');
                document.getElementById(`lbl-${index}-${q.a}`).classList.add('correct-answer');
                expBox.innerHTML = `<strong>‚ùå FALLO</strong><br>La correcta era: <b>${q.o[q.a]}</b><br><em>${q.e}</em>`;
                
                reviewHTML += `<div class="review-item r-wrong"><b>${index+1}. Fallo</b><br>Tu respuesta: ${q.o[userVal]}<br>Correcta: <strong>${q.o[q.a]}</strong></div>`;
            
            } else {
                // En blanco
                card.classList.add('wrong-card');
                document.getElementById(`lbl-${index}-${q.a}`).classList.add('correct-answer');
                expBox.innerHTML = `<strong>‚ö™ EN BLANCO</strong><br>La correcta era: <b>${q.o[q.a]}</b><br><em>${q.e}</em>`;
                
                reviewHTML += `<div class="review-item r-wrong"><b>${index+1}. En blanco</b><br>Correcta: <strong>${q.o[q.a]}</strong></div>`;
            }
            
            expBox.style.display = 'block';
        });

        // BAREMO CEI
        let verdict = "";
        let color = "";

        if (correctCount >= 45) { // 45-50
            verdict = "SOBRESALIENTE üèÜ";
            color = "#28a745";
        } else if (correctCount >= 40) { // 40-44
            verdict = "NOTABLE üåü";
            color = "#17a2b8";
        } else if (correctCount >= 35) { // 35-39
            verdict = "BIEN üëç";
            color = "#2271b1";
        } else if (correctCount >= 30) { // 30-34
            verdict = "APTO üëå";
            color = "#fd7e14";
        } else {
            verdict = "NO APTO ‚ùå";
            color = "#dc3545";
        }

        // PINTAR MODAL
        document.getElementById('score-display').innerText = `${correctCount} / 50`;
        document.getElementById('score-display').style.color = color;
        
        const vText = document.getElementById('verdict-text');
        vText.innerText = verdict;
        vText.style.color = color;

        document.getElementById('res-correct').innerText = correctCount;
        document.getElementById('res-wrong').innerText = 50 - correctCount;

        document.getElementById('detailed-review').innerHTML = reviewHTML;
        document.getElementById('result-modal').style.display = 'flex';
    };

    function startTimer() {
        timer = setInterval(() => {
            timeLeft--;
            let m = Math.floor(timeLeft / 60);
            let s = timeLeft % 60;
            document.getElementById('timer').innerText = `${m}:${s < 10 ? '0'+s : s}`;
            if(timeLeft <= 0) finishExam();
        }, 1000);
    }

    window.onload = function() {
        if(typeof DB !== 'undefined') init();
    };

</script>
</body>
</html>