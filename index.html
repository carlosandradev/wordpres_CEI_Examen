<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>12.0</title>
    <style>
        :root { --primary: #2271b1; --success: #28a745; --error: #dc3545; --bg: #f0f0f1; }
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; background-color: var(--bg); color: #3c434a; margin: 0; padding-bottom: 100px; }
        
        .header { position: fixed; top: 0; left: 0; right: 0; background: #fff; border-bottom: 1px solid #c3c4c7; padding: 15px 20px; z-index: 1000; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 1px 3px rgba(0,0,0,0.05); }
        .logo { font-weight: 800; color: var(--primary); font-size: 1.2rem; }
        .timer-box { font-variant-numeric: tabular-nums; font-size: 1.4rem; font-weight: 700; color: #1d2327; background: #f0f0f1; padding: 5px 15px; border-radius: 4px; }
        
        .container { max-width: 800px; margin: 90px auto 20px; padding: 0 20px; }

        .card { background: #fff; border: 1px solid #c3c4c7; padding: 25px; margin-bottom: 25px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.02); }
        .q-text { font-size: 1.1rem; font-weight: 600; margin-bottom: 20px; color: #1d2327; line-height: 1.5; }
        
        .option-label { display: flex; align-items: flex-start; gap: 12px; padding: 12px; border: 2px solid #f0f0f1; border-radius: 6px; cursor: pointer; transition: all 0.2s; margin-bottom: 10px; font-size: 0.95rem; }
        .option-label:hover { background: #f6f7f7; border-color: var(--primary); }
        .option-label input { margin-top: 3px; transform: scale(1.3); cursor: pointer; flex-shrink: 0; accent-color: var(--primary); }
        
        .fab-finish { position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%); background: #d63638; color: white; padding: 15px 40px; border-radius: 50px; border: none; font-size: 1.2rem; font-weight: bold; cursor: pointer; box-shadow: 0 4px 15px rgba(214, 54, 56, 0.4); z-index: 999; transition: transform 0.2s; white-space: nowrap; }
        .fab-finish:hover { transform: translateX(-50%) scale(1.05); background: #b32d2e; }

        /* MODAL RESULTADOS */
        .modal { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.9); z-index: 2000; justify-content: center; align-items: center; }
        .modal-content { background: white; width: 90%; max-width: 800px; max-height: 90vh; border-radius: 12px; display: flex; flex-direction: column; overflow: hidden; position: relative; }
        
        .modal-header { padding: 20px; background: #f9f9f9; border-bottom: 1px solid #eee; text-align: center; }
        .score-big { font-size: 2.5rem; font-weight: 800; margin: 10px 0; color: var(--primary); }
        .verdict { font-size: 1.5rem; font-weight: 700; text-transform: uppercase; margin-bottom: 10px; }
        
        .modal-body { padding: 20px; overflow-y: auto; flex-grow: 1; text-align: left; background: #f0f0f1; }
        
        .btn-restart { background: var(--primary); color: white; border: none; padding: 15px; font-size: 1.1rem; cursor: pointer; width: 100%; font-weight: bold; }
        .btn-restart:hover { background: #135e96; }

        /* REVISI√ìN DETALLADA */
        .review-item { background: white; padding: 15px; margin-bottom: 15px; border-radius: 8px; border-left: 5px solid #ccc; font-size: 0.95rem; }
        .review-item.r-correct { border-left-color: var(--success); background: #f4fff7; }
        .review-item.r-wrong { border-left-color: var(--error); background: #fff5f5; }
        
        .r-question { font-weight: bold; margin-bottom: 10px; display: block; color: #333; }
        .r-user-ans { display: block; margin-bottom: 5px; }
        .r-correct-ans { display: block; margin-bottom: 5px; color: var(--success); font-weight: 600; }
        .r-explanation { display: block; margin-top: 10px; font-style: italic; color: #666; font-size: 0.9rem; border-top: 1px solid rgba(0,0,0,0.05); padding-top: 5px; }

        .tag-correct { color: var(--success); font-weight: bold; }
        .tag-wrong { color: var(--error); font-weight: bold; text-decoration: line-through; }

        .progress-container { position: fixed; top: 69px; left: 0; width: 100%; height: 4px; background: #e0e0e0; z-index: 998; }
        .progress-bar { height: 100%; background: var(--primary); width: 0%; transition: width 0.3s; }

        .explanation-box { display: none; margin-top: 15px; padding: 12px; background: #f9f9f9; border-left: 4px solid #ccc; border-radius: 4px; font-size: 0.9rem; color: #555; }
        .correct-card .explanation-box { border-left-color: var(--success); background: #f4fff7; }
        .wrong-card .explanation-box { border-left-color: var(--error); background: #fff5f5; }
        .correct-answer { background: #d4edda !important; border-color: var(--success) !important; }
        .user-wrong { background: #f8d7da !important; border-color: var(--error) !important; }
        .options-group { display: flex; flex-direction: column; }
    </style>
</head>
<body>

    <div id="result-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 style="margin:0;">RESULTADO</h2>
                <div id="score-display" class="score-big">0 / 50</div>
                <div id="verdict-text" class="verdict">...</div>
                <div style="font-size:0.9rem; color:#666;">
                    ‚úÖ <span id="res-correct">0</span> | 
                    ‚ùå <span id="res-wrong">0</span>
                </div>
            </div>
            <div class="modal-body" id="detailed-review"></div>
            <button class="btn-restart" onclick="location.reload()">REPETIR EXAMEN</button>
        </div>
    </div>

    <header class="header">
        <div class="logo">EXAMEN WP AVANZADO</div>
        <div class="timer-box" id="timer">45:00</div>
    </header>
    <div class="progress-container"><div class="progress-bar" id="progress"></div></div>

    <div class="container" id="quiz-container"></div>

    <button class="fab-finish" onclick="finishExam()">FINALIZAR Y CALIFICAR</button>

<script>
const DB = [
{ q: "¬øEn qu√© archivo se guardan los datos de conexi√≥n a la base de datos?", options: ["index.php", "wp-admin.php", "wp-config.php", "functions.php"], a: 2, exp: "Vital: wp-config.php contiene DB_NAME, DB_USER y DB_PASSWORD." },
    { q: "¬øCu√°l es el prefijo de tablas recomendado por seguridad para evitar ataques?", options: ["wp_", "wordpress_", "Algo aleatorio como x7z_", "db_"], a: 2, exp: "Cambiar 'wp_' por defecto evita ataques automatizados SQL Injection." },
    { q: "Para SEO, ¬øcu√°l es la configuraci√≥n recomendada de Enlaces Permanentes?", options: ["Simple (?p=123)", "D√≠a y nombre", "Nombre de la entrada (Post name)", "Num√©rico"], a: 2, exp: "Ayuda a Google a leer la URL y mejora el posicionamiento." },
    { q: "¬øQu√© archivo maneja las redirecciones y la configuraci√≥n del servidor en Apache?", options: [".htaccess", "robots.txt", "config.sys", "sitemap.xml"], a: 0, exp: "El .htaccess permite forzar HTTPS y configurar redirecciones." },
    { q: "Seg√∫n el RGPD, ¬øc√≥mo debe ser el checkbox de aceptaci√≥n en formularios?", options: ["Pre-marcado por defecto", "Oculto", "Desmarcado y obligatorio", "Opcional"], a: 2, exp: "El usuario debe realizar una acci√≥n afirmativa (marcarlo manualmente)." },
    { q: "¬øQu√© peso m√°ximo recomendado deber√≠an tener las im√°genes para optimizaci√≥n (WPO)?", options: ["1 MB", "500 KB", "200 KB", "5 MB"], a: 2, exp: "La regla de oro en tus apuntes es mantenerlas por debajo de 200KB." },
    { q: "¬øQu√© es un 'Loop Item' en Elementor Theme Builder?", options: ["La p√°gina de blog", "El dise√±o de una tarjeta individual de post", "El pie de p√°gina", "Un plugin de bucles"], a: 1, exp: "Es la plantilla de dise√±o para un solo elemento dentro de una rejilla." },
    { q: "Si dos cabeceras sticky se solapan, ¬øqu√© propiedad de Elementor soluciona esto?", options: ["Z-Index", "Offset (Desplazamiento)", "Margin-top", "Padding"], a: 1, exp: "El Offset permite desplazar la activaci√≥n del efecto sticky." },
    { q: "¬øQu√© tipo de producto de WooCommerce usar√≠as para vender un pack de 3 productos existentes?", options: ["Producto Simple", "Producto Variable", "Producto Agrupado", "Producto Externo"], a: 2, exp: "Permite agrupar varios productos simples en una sola ficha." },
    { q: "¬øQu√© plugin se menciona en el manual para copias de seguridad y migraci√≥n?", options: ["Jetpack", "All-in-one WP Migration", "WooCommerce", "Elementor Pro"], a: 1, exp: "Es la herramienta est√°ndar recomendada en el curso para backups." },
    { q: "¬øCu√°l es la funci√≥n principal de 'Lazy Load'?", options: ["Cargar im√°genes solo cuando son visibles", "Hacer la web m√°s lenta", "Cargar todo al principio", "Comprimir el CSS"], a: 0, exp: "Difiere la carga de medios hasta que el usuario hace scroll hacia ellos." },
    { q: "¬øQu√© es un CPT en WordPress?", options: ["Central Processing Unit", "Custom Post Type", "Control Panel Theme", "Cascading Page Type"], a: 1, exp: "Tipos de contenido personalizados (ej: Proyectos, Doctores, Inmuebles)." },
    { q: "¬øPara qu√© sirve el archivo robots.txt?", options: ["Para dise√±ar la web", "Para dar instrucciones a los bots de b√∫squeda", "Para guardar contrase√±as", "Para instalar plugins"], a: 1, exp: "Indica a Google qu√© partes de la web puede o no rastrear." },
    { q: "¬øQu√© rol de usuario tiene acceso total a todas las funciones de WordPress?", options: ["Editor", "Autor", "Administrador", "Suscriptor"], a: 2, exp: "El Administrador es el √∫nico con control total sobre temas y plugins." },
    { q: "¬øQu√© diferencia hay entre Entradas y P√°ginas?", options: ["No hay diferencia", "Las entradas son cronol√≥gicas y las p√°ginas est√°ticas", "Las p√°ginas tienen categor√≠as y las entradas no", "Las entradas son para el men√∫ legal"], a: 1, exp: "Entradas = Blog/Noticias (tiempo). P√°ginas = Qui√©nes somos/Contacto (atemporal)." },
    { q: "¬øQu√© es un Child Theme (Tema Hijo)?", options: ["Un tema para webs infantiles", "Una copia que hereda funciones del padre para modificar c√≥digo sin perder cambios al actualizar", "Un plugin de dise√±o", "Una versi√≥n antigua del tema"], a: 1, exp: "Fundamental para desarrolladores para preservar personalizaciones." },
    { q: "En WooCommerce, ¬ød√≥nde se configuran los impuestos?", options: ["En Apariencia", "En Ajustes > Generales", "En WooCommerce > Ajustes > Impuestos", "No se pueden configurar"], a: 2, exp: "Debes activar primero la opci√≥n en Ajustes Generales de Woo para que aparezca la pesta√±a." },
    { q: "¬øQu√© herramienta del navegador se usa para inspeccionar c√≥digo y ver errores?", options: ["La barra de marcadores", "El historial", "DevTools (Inspeccionar elemento)", "El gestor de descargas"], a: 2, exp: "F12 o Clic derecho > Inspeccionar es clave para depurar CSS y errores." },
    { q: "¬øQu√© es el 'Slug' en una URL?", options: ["El protocolo https", "El nombre de dominio", "La parte final amigable que identifica la p√°gina", "La extensi√≥n .com"], a: 2, exp: "Ejemplo: en tudominio.com/contacto, 'contacto' es el slug." },
    { q: "¬øCu√°l es la medida est√°ndar de resoluci√≥n para pantallas de escritorio (Desktop) en dise√±o?", options: ["1920px", "300px", "768px", "4000px"], a: 0, exp: "Full HD 1920x1080 es el est√°ndar de referencia actual." },
    { q: "¬øQu√© plugin de cach√© se menciona en la lista de 'Plugins Premium' del manual?", options: ["W3 Total Cache", "WP Rocket", "Super Cache", "Autoptimize"], a: 1, exp: "WP Rocket es el plugin premium de referencia para WPO." },
    { q: "¬øPara qu√© sirve el 'Texto Alternativo' (Alt Text) en im√°genes?", options: ["Para que Google entienda la imagen y accesibilidad", "Para poner t√≠tulo visible", "Para reducir el peso", "No sirve para nada"], a: 0, exp: "Crucial para SEO y para lectores de pantalla de personas ciegas." },
    { q: "¬øQu√© es un Favicon?", options: ["El logo grande de la web", "El icono peque√±o en la pesta√±a del navegador", "Un tipo de fuente", "Un plugin de Facebook"], a: 1, exp: "Peque√±a imagen cuadrada que identifica la web en el navegador." },
    { q: "Si usas LocalWP, ¬øqu√© es un 'Blueprint'?", options: ["Un error de c√≥digo", "Una plantilla de sitio pre-configurada para reutilizar", "Un plano de la base de datos", "El color de fondo"], a: 1, exp: "Te permite guardar tu configuraci√≥n base de plugins/temas para no empezar de cero." },
    { q: "¬øQu√© significa CMS?", options: ["Computer Main System", "Content Management System", "Creative Mode Style", "Code Master Source"], a: 1, exp: "Sistema de Gesti√≥n de Contenidos (como WordPress)." },
    { q: "En Elementor, ¬øqu√© diferencia hay entre Margin y Padding?", options: ["Son lo mismo", "Margin es espacio externo, Padding es espacio interno", "Margin es interno, Padding es externo", "Padding es para colores"], a: 1, exp: "Margin separa elementos entre s√≠. Padding separa el contenido de su propio borde." },
    { q: "¬øQu√© es una 'Breadcrumb' (Miga de pan)?", options: ["Un tipo de cookie", "Un rastro de navegaci√≥n (Inicio > Tienda > Zapatos)", "Un error 404", "Un men√∫ de footer"], a: 1, exp: "Mejora la UX indicando al usuario d√≥nde est√° en la jerarqu√≠a." },
    { q: "¬øC√≥mo se llama el editor por defecto actual de WordPress?", options: ["Classic Editor", "Elementor", "Gutenberg (Editor de Bloques)", "Divi"], a: 2, exp: "Desde la versi√≥n 5.0, Gutenberg es el nativo." },
    { q: "¬øQu√© es el 'Responsive Design'?", options: ["Dise√±o que responde a comandos de voz", "Dise√±o que se adapta a cualquier tama√±o de pantalla", "Dise√±o r√°pido", "Dise√±o solo para m√≥viles"], a: 1, exp: "Obligatorio hoy en d√≠a: que la web se vea bien en m√≥vil, tablet y PC." },
    { q: "¬øCu√°l es la funci√≥n de un plugin de seguridad como Wordfence?", options: ["Mejorar el dise√±o", "Proteger contra fuerza bruta y firewall", "Hacer copias de seguridad", "Traducir la web"], a: 1, exp: "Monitoriza tr√°fico, bloquea IPs maliciosas y escanea archivos." },
    { q: "¬øQu√© estado de pedido en WooCommerce indica que el pago se ha recibido?", options: ["Pendiente de pago", "Procesando", "En espera", "Cancelado"], a: 1, exp: "'Procesando' significa pago correcto y stock reducido, listo para enviar." },
    { q: "Seg√∫n tus apuntes, ¬øqu√© se debe evitar en el men√∫ de navegaci√≥n?", options: ["Poner 'Inicio'", "Tener demasiados √≠tems (m√°s de 7)", "Usar desplegables", "Poner el logo"], a: 1, exp: "Por usabilidad, la memoria a corto plazo gestiona mal m√°s de 7 elementos." },
    { q: "¬øQu√© es el 'Loop' de WordPress?", options: ["Un error infinito", "El c√≥digo PHP que procesa y muestra las entradas", "Un plugin de m√∫sica", "El pie de p√°gina"], a: 1, exp: "Es el coraz√≥n de WP: 'Si hay posts, mu√©stralos mientras haya'." },
    { q: "¬øQu√© archivo CSS se carga √∫ltimo y permite sobrescribir estilos?", options: ["style.css del tema padre", "bootstrap.css", "style.css del tema hijo o CSS personalizado", "normalize.css"], a: 2, exp: "La cascada (C en CSS) da prioridad a lo √∫ltimo cargado." },
    { q: "¬øQu√© es una Landing Page?", options: ["La p√°gina de inicio", "Una p√°gina dise√±ada espec√≠ficamente para convertir (vender/captar)", "Una p√°gina de error", "El blog"], a: 1, exp: "Se eliminan distracciones (men√∫s) para enfocar en una sola acci√≥n." },
    { q: "¬øPara qu√© sirve el plugin 'Loco Translate'?", options: ["Para traducir temas y plugins directamente en WordPress", "Para traducir la web autom√°ticamente como Google", "Para mover la web", "Para cambiar el idioma del admin"], a: 0, exp: "Permite crear archivos .po y .mo para traducir cadenas de texto internas." },
    { q: "¬øQu√© es un Shortcode?", options: ["Un c√≥digo corto entre corchetes [ ] para insertar funciones", "Un error de PHP", "Una contrase√±a corta", "Un enlace roto"], a: 0, exp: "Ejemplo: [contact-form-7] invoca el formulario." },
    { q: "Si la web muestra una 'Pantalla Blanca de la Muerte' (WSOD), ¬øqu√© suele ser?", options: ["Se ha roto la pantalla", "Error de PHP o falta de memoria", "Error de conexi√≥n a internet", "Virus"], a: 1, exp: "Generalmente causado por incompatibilidad de plugins o temas." },
    { q: "¬øQu√© etiqueta HTML es la m√°s importante para el SEO en una p√°gina?", options: ["H2", "H1", "Bold", "Span"], a: 1, exp: "Solo debe haber un H1 por p√°gina describiendo el contenido principal." },
    { q: "¬øQu√© es 'Squoosh' seg√∫n tus apuntes?", options: ["Un plugin de cach√©", "Una herramienta online para comprimir im√°genes manualmente", "Un tema de WordPress", "Un servidor"], a: 1, exp: "Recomendado para limpiar im√°genes antes de subirlas." },
    { q: "¬øQu√© diferencia hay entre http y https?", options: ["La 's' significa velocidad", "La 's' significa seguridad (SSL/TLS encryptado)", "No hay diferencia", "Http es para m√≥viles"], a: 1, exp: "HTTPS encripta los datos entre navegador y servidor. Obligatorio hoy." },
    { q: "En Elementor, ¬øqu√© es un 'Global Widget'?", options: ["Un widget que se ve en todo el mundo", "Un elemento que si editas en un sitio, cambia en todos", "Un widget de traducci√≥n", "Un mapa"], a: 1, exp: "√ötil para elementos repetitivos como Call to Actions id√©nticos." },
    { q: "¬øQu√© significa la regla de los 3 clics?", options: ["Debes hacer 3 clics para guardar", "El usuario debe encontrar lo que busca en m√°x 3 clics", "El rat√≥n debe tener 3 botones", "WordPress se instala en 3 clics"], a: 1, exp: "Principio b√°sico de usabilidad y arquitectura web." },
    { q: "¬øQu√© es el 'Mobile First'?", options: ["Dise√±ar primero para m√≥vil y luego escalar a escritorio", "Dise√±ar solo para m√≥vil", "Que el m√≥vil es lo m√°s caro", "Usar el m√≥vil para dise√±ar"], a: 0, exp: "Estrategia de dise√±o actual dado que la mayor√≠a del tr√°fico es m√≥vil." },
    { q: "Para vender productos descargables (ebooks), ¬øqu√© marcas en WooCommerce?", options: ["Virtual y Descargable", "Solo Virtual", "Solo Descargable", "F√≠sico"], a: 0, exp: "Virtual elimina el env√≠o, Descargable habilita la subida del archivo." },
    { q: "¬øQu√© es una Zona de Env√≠o en WooCommerce?", options: ["El lugar donde almacenas productos", "√Årea geogr√°fica con m√©todos de env√≠o espec√≠ficos", "La direcci√≥n del cliente", "Un plugin de correos"], a: 1, exp: "Permite poner precios distintos (ej: Pen√≠nsula vs Canarias)." },
    { q: "¬øCu√°l es el hook (gancho) principal para el pie de p√°gina?", options: ["wp_head", "wp_footer", "wp_body", "wp_bottom"], a: 1, exp: "Es donde se inyectan scripts de cierre y la barra de admin." },
    { q: "¬øQu√© es el archivo functions.php?", options: ["Un archivo de texto", "El cerebro del tema donde a√±adir c√≥digo PHP personalizado", "La base de datos", "El instalador"], a: 1, exp: "Act√∫a como un plugin integrado en el tema." },
    { q: "Si quieres ocultar una p√°gina a Google, ¬øqu√© meta etiqueta usas?", options: ["noindex", "nofollow", "hidden", "private"], a: 0, exp: "Indica a los motores de b√∫squeda que no incluyan esa p√°gina en resultados." }
    ];

    let questions = []; 
    let timer;
    let timeLeft = 45 * 60; 

    function init() {
        if(typeof DB === 'undefined') return alert("‚ö†Ô∏è ERROR: No has pegado las preguntas.");
        
        // Seleccionar 50 aleatorias
        questions = DB.sort(() => 0.5 - Math.random()).slice(0, 50);
        
        const container = document.getElementById('quiz-container');
        container.innerHTML = ""; 
        
        questions.forEach((q, index) => {
            // --- FIX: A√±adir comprobaci√≥n para evitar errores si una pregunta no tiene opciones ---
            if (!q.o || !Array.isArray(q.o)) {
                console.error(`Pregunta #${index} omitida por no tener opciones v√°lidas.`, q);
                return; // Saltar esta pregunta
            }
            // --- FIN DEL FIX ---

            let html = `
                <div class="card" id="card-${index}">
                    <div class="q-text"><span style="color:#2271b1; font-weight:800;">#${index + 1}</span> ${q.q}</div>
            `;
            
            // Barajar opciones visualmente
            let indices = q.o.map((_, i) => i);
            indices.sort(() => 0.5 - Math.random());

            html += `<div class="options-group">`;
            indices.forEach(i => {
                html += `
                    <label class="option-label" id="lbl-${index}-${i}">
                        <input type="radio" name="q_${index}" value="${i}">
                        ${q.o[i]}
                    </label>
                `;
            });

            html += `</div>
                     <div class="explanation-box" id="exp-${index}"></div>
                     </div>`;
            container.innerHTML += html;
        });

        startTimer();
        
        // Barra de progreso
        document.querySelectorAll('input').forEach(i => {
            i.addEventListener('change', () => {
                const answered = document.querySelectorAll('input:checked').length;
                document.getElementById('progress').style.width = `${(answered/50)*100}%`;
            });
        });
    }

    window.finishExam = function() {
        clearInterval(timer);
        
        let correctCount = 0;
        let reviewHTML = "";

        // Recorremos las 50 preguntas
        questions.forEach((q, index) => {
            const card = document.getElementById(`card-${index}`);
            const expBox = document.getElementById(`exp-${index}`);
            const selected = document.querySelector(`input[name="q_${index}"]:checked`);
            
            let userVal = selected ? parseInt(selected.value) : -1; 
            let isCorrect = (userVal === q.a);
            
            // Bloquear inputs
            card.querySelectorAll('input').forEach(i => i.disabled = true);

            // LOGICA VISUAL DETALLADA
            if (isCorrect) {
                correctCount++;
                card.classList.add('correct-card');
                document.getElementById(`lbl-${index}-${userVal}`).classList.add('correct-answer');
                expBox.innerHTML = `<strong>‚úÖ ¬°CORRECTO!</strong>${q.e}`;
                
                // Add to modal review
                reviewHTML += `<div class="review-item r-correct"><b>${index+1}. Acierto</b><br>Tu respuesta: ${q.o[userVal]}</div>`;
            
            } else if (userVal !== -1) {
                // Fall√≥
                card.classList.add('wrong-card');
                document.getElementById(`lbl-${index}-${userVal}`).classList.add('user-wrong');
                document.getElementById(`lbl-${index}-${q.a}`).classList.add('correct-answer');
                expBox.innerHTML = `<strong>‚ùå FALLO</strong><br>La correcta era: <b>${q.o[q.a]}</b><br><em>${q.e}</em>`;
                
                reviewHTML += `<div class="review-item r-wrong"><b>${index+1}. Fallo</b><br>Tu respuesta: ${q.o[userVal]}<br>Correcta: <strong>${q.o[q.a]}</strong></div>`;
            
            } else {
                // En blanco
                card.classList.add('wrong-card');
                document.getElementById(`lbl-${index}-${q.a}`).classList.add('correct-answer');
                expBox.innerHTML = `<strong>‚ö™ EN BLANCO</strong><br>La correcta era: <b>${q.o[q.a]}</b><br><em>${q.e}</em>`;
                
                reviewHTML += `<div class="review-item r-wrong"><b>${index+1}. En blanco</b><br>Correcta: <strong>${q.o[q.a]}</strong></div>`;
            }
            
            expBox.style.display = 'block';
        });

        // BAREMO CEI
        let verdict = "";
        let color = "";

        if (correctCount >= 45) { // 45-50
            verdict = "SOBRESALIENTE üèÜ";
            color = "#28a745";
        } else if (correctCount >= 40) { // 40-44
            verdict = "NOTABLE üåü";
            color = "#17a2b8";
        } else if (correctCount >= 35) { // 35-39
            verdict = "BIEN üëç";
            color = "#2271b1";
        } else if (correctCount >= 30) { // 30-34
            verdict = "APTO üëå";
            color = "#fd7e14";
        } else {
            verdict = "NO APTO ‚ùå";
            color = "#dc3545";
        }

        // PINTAR MODAL
        document.getElementById('score-display').innerText = `${correctCount} / 50`;
        document.getElementById('score-display').style.color = color;
        
        const vText = document.getElementById('verdict-text');
        vText.innerText = verdict;
        vText.style.color = color;

        document.getElementById('res-correct').innerText = correctCount;
        document.getElementById('res-wrong').innerText = 50 - correctCount;

        document.getElementById('detailed-review').innerHTML = reviewHTML;
        document.getElementById('result-modal').style.display = 'flex';
    };

    function startTimer() {
        timer = setInterval(() => {
            timeLeft--;
            let m = Math.floor(timeLeft / 60);
            let s = timeLeft % 60;
            document.getElementById('timer').innerText = `${m}:${s < 10 ? '0'+s : s}`;
            if(timeLeft <= 0) finishExam();
        }, 1000);
    }

    window.onload = function() {
        if(typeof DB !== 'undefined') init();
    };

</script>
</body>
</html>